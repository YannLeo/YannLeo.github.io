# 幻觉缓解

## 四、如何缓解大模型幻觉问题？

### 4.1 基于数据的工作 -- 构建高质量数据集

为了减少大模型生成内容时的幻觉问题，首先需要关注数据的质量。数据质量直接影响模型的生成效果，因此在训练和评估数据上进行改进，能够有效降低模型产生幻觉的风险。下面是两种具体方法：

#### 4.1.1 人工标注

- 训练数据：
    - 对于大模型（LLM）训练，使用人工标注的训练数据并不总是可行，尤其是当模型需要适应多样化任务时。不过，**对于特定任务产生的幻觉问题，人工标注的数据仍然有用。通过人工标注，可以构建高质量的、适用于某些特定任务的数据集**。

- 评测数据：
    - 为了分析模型的幻觉问题，可以构建一个细粒度的幻觉评估基准集（benchmark），使模型生成内容后能通过这一基准集的测试，帮助分析模型的幻觉严重程度及其产生的原因。

#### 4.1.2 自动筛选

- **筛选不良数据**：
    - **利用模型筛选出那些可能导致幻觉的数据，并将这些数据剔除**。这样可以在训练时减少错误或幻觉的输入来源。

- **数据加权**：
    - 在预测时，可以给**可靠度更高的数据（如维基百科的数据）赋予更高的权重，而对于不可靠的数据（例如虚假新闻）则不使用或降低权重**。通过只选用经过人工审核的数据源（如维基百科或教科书），可以增强模型对可信信息的依赖。


### 4.2 模型层面的工作 -- 从模型结构和训练方式入手

#### 4.2.1 模型结构

模型结构方面的改进主要关注在设计能够更好地利用来源信息的结构。例如：

- **编码更多信息**：尝试融入能反映人类思维偏好的结构，例如图神经网络（GNN），使得模型在生成时可以更好地参考和利用原始信息源。
- **减少生成随机性**：在解码时减少模型生成内容的随机性。因为生成的多样性（diversity）和准确性（faithfulness）常常是一个相互影响的关系。通过降低多样性，模型更可能生成准确、基于事实的回答。
- **检索增强**：引入外部检索系统（例如LLaMA-index），通过让模型能访问到可靠的外部信息来源，显著降低幻觉现象。

#### 4.2.2 训练方式

在训练方法上，有几种策略可以缓解幻觉问题：

- **可控文本生成**：将幻觉控制为一个可控属性，让模型在生成时更少产生幻觉。
- **提前规划内容框架**：采用"草图到内容"（sketch to content）的方法，**先规划一个大致的框架再生成具体内容，有助于结构化信息和减少偏差**。
- **强化学习**：通常模型使用最大似然估计（MLE）来优化训练目标，这可能会暴露偏差。通过**引入强化学习，将减少幻觉的目标作为奖励函数，调整模型生成过程**。
- **多任务学习**：通过设计额外的任务，使模型在执行多项任务时能提升应对幻觉的能力。
- **后处理**：设计一个专门的小模型用于后处理，识别并修正模型输出中的幻觉错误。

这种从模型结构到训练方式的优化方法，有助于提升LLM生成内容的准确性与可靠性，缓解幻觉现象。


> ## 通过使用外部知识验证主动检测和减轻幻觉

> 文章：《A Stitch in Time Saves Nine: Detecting and Mitigating Hallucinations of LLMs by Validating Low-Confidence Generation》

作者发现

- 幻觉的生成是会传播的，比如一句话出现幻觉，后续生成的文本可能也会出现幻觉甚至更严重。这意味着，如果我们能够"主动"检测并减轻幻觉，那么我们也可以阻止其在后续生成的句子中的传播。
- logit输出值（输出词汇表上的概率分布）可以用来获取幻觉的信号。具体地说，我们计算了一个概率得分，并展示了当这个得分很低时，模型更容易产生幻觉。因此，它可以作为幻觉的一个信号，当得分很低时，可以对生成的内容进行信息验证。

基于这两个发现，作者提出了主动检测和减轻的方法。

<center>
    <img src="../fig/09-method.png">
</center>

图 2：展示我们提出的解决大型语言模型（LLM）幻觉问题的方法。

- 给定一个输入，通过迭代生成句子，并积极检测和缓解幻觉现象。
- 在检测阶段，首先识别重要概念，计算模型在这些概念上的不确定性，并通过检索相关知识验证这些不确定概念的正确性。
- 在缓解阶段，使用检索到的知识作为依据修复存在幻觉的句子。
- 最后，将修复后的句子添加到输入（和之前生成的句子）中，并继续生成下一个句子。
- 实验表明，该过程不仅可以减轻当前的幻觉问题，还能防止幻觉在后续生成的句子中传播。

### 4.3 总结

如何缓解大模型幻觉问题？

- **基于数据的工作 - 构建高质量数据集**
    - 人工标注方法
    - 自动筛选方法
- **模型层面的工作 - 从模型结构和训练方式入手**
    - 模型结构
        - 编码更多信息
        - 减少生成随机性
        - 检索增强
    - 训练方式
        - 可控文本生成
        - 提前规划内容框架
        - 强化学习
        - 多任务学习
        - 后处理